/* ==========================================================================
   components.css — Librería UI (botones, formularios, tarjetas, badges, nav)
   - TODOS los colores/espacios/radios salen de tokens.
   - Sin valores mágicos de color. Solo variables.
   ========================================================================== */

@layer components {

  /* ——— Botones ——— */
  .btn {
    --btn-bg: var(--c-neutral-200);
    --btn-color: var(--c-text);
    --btn-border: var(--c-border);

    display: inline-flex; align-items: center; justify-content: center;
    gap: .5rem;
    padding: .5rem .9rem;
    border-radius: var(--radius-md);
    border: 1px solid var(--btn-border);
    background: var(--btn-bg);
    color: var(--btn-color);
    box-shadow: var(--shadow-sm);
    cursor: pointer;
    transition: background .2s ease, color .2s ease, border-color .2s ease, box-shadow .2s ease, transform .02s ease;
  }
  .btn:hover { filter: brightness(0.98); }
  .btn:active { transform: translateY(1px); }
  .btn:focus-visible {
    outline: none;
    box-shadow: 0 0 0 var(--ring-width) var(--ring-color);
  }
  .btn[disabled], .btn:disabled {
    opacity: .6; cursor: not-allowed; box-shadow: none;
  }

  .btn--primary {
    --btn-bg: var(--c-primary);
    --btn-color: var(--c-on-primary);
    --btn-border: color-mix(in srgb, var(--c-primary), #000 18%);
  }
  .btn--secondary {
    --btn-bg: var(--c-secondary);
    --btn-color: #ffffff;
    --btn-border: color-mix(in srgb, var(--c-secondary), #000 18%);
  }
  .btn--danger {
    --btn-bg: var(--c-error);
    --btn-color: var(--c-white);
    --btn-border: color-mix(in srgb, var(--c-error), #000 18%);
  }
  .btn--danger:hover {
    --btn-bg: color-mix(in srgb, var(--c-error), #000 10%);
    --btn-border: color-mix(in srgb, var(--c-error), #000 26%);
    filter: none;
  }
  .btn--danger:active {
    --btn-bg: color-mix(in srgb, var(--c-error), #000 16%);
    --btn-border: color-mix(in srgb, var(--c-error), #000 32%);
  }
  .btn--danger:focus-visible {
    outline: none;
    box-shadow: 0 0 0 var(--ring-width) var(--ring-color);
  }
  .btn--danger[aria-disabled="true"] {
    opacity: .6;
    cursor: not-allowed;
    box-shadow: none;
    pointer-events: none;
  }
  .btn--outline {
    --btn-bg: transparent;
    --btn-color: var(--c-text);
    --btn-border: var(--c-border);
    background: transparent;
  }
  .btn--ghost {
    --btn-bg: transparent;
    --btn-color: var(--c-text);
    --btn-border: color-mix(in srgb, var(--c-border) 65%, transparent);
    background: transparent;
    box-shadow: none;
  }
  .btn--ghost:hover {
    background: color-mix(in srgb, var(--c-secondary) 8%, transparent);
    --btn-border: color-mix(in srgb, var(--c-secondary) 40%, transparent);
  }
  .btn--sm {
    padding: var(--space-2) var(--space-3);
    min-height: calc(var(--space-6) + var(--space-1));
    font-size: var(--fs-h6);
    box-shadow: none;
  }
  .btn--icon {
    padding: var(--space-2);
    min-width: calc(var(--space-6) + var(--space-1));
    min-height: calc(var(--space-6) + var(--space-1));
    box-shadow: none;
  }
  .btn--icon .icon { margin: 0; }

  /* ——— Formularios ——— */
  .form-control {
    display: block; width: 100%;
    padding: .55rem .75rem;
    border: 1px solid var(--c-border);
    border-radius: var(--radius-md);
    background: var(--c-white);
    color: var(--c-text);
    box-shadow: none;
    transition: border-color .2s ease, box-shadow .2s ease;
  }
  .form-control::placeholder { color: var(--c-text-muted); }
  .form-control:focus {
    outline: none;
    border-color: var(--c-secondary);
    box-shadow: 0 0 0 var(--ring-width) var(--ring-color);
  }
  .form-control.is-invalid {
    border-color: var(--c-error);
    box-shadow: 0 0 0 var(--ring-width) rgba(220, 38, 38, .25);
  }
  .form-control.is-valid {
    border-color: var(--c-success);
    box-shadow: 0 0 0 var(--ring-width) rgba(22, 163, 74, .25);
  }
  .form-hint { color: var(--c-text-muted); font-size: .875rem; margin-top: .375rem; }
  .form-error { color: var(--c-error); font-size: .875rem; margin-top: .375rem; }
  .form-success { color: var(--c-success); font-size: .875rem; margin-top: .375rem; }

  select.form-control, textarea.form-control { min-height: 2.5rem; }

  .form-control--dense {
    padding: var(--space-2) var(--space-3);
    min-height: calc(var(--space-6) + var(--space-1));
    font-size: var(--fs-base);
  }

  /* ——— Modales ——— */
  .modal {
    position: fixed; inset: 0; z-index: 50;
    display: none; align-items: center; justify-content: center;
    background: rgba(0,0,0,.5);
    padding: var(--space-4);
  }
  .modal.is-open { display: flex; }
  .modal__dialog {
    width: 100%; max-width: 640px;
    background: var(--c-surface);
    color: var(--c-text);
    border: 1px solid var(--c-border);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-lg);
    overflow: hidden;
  }
  .modal__header, .modal__footer { padding: var(--space-4); background: var(--c-surface-muted); }
  .modal__body { padding: var(--space-4); }
  .modal__title { font-size: var(--fs-h4); font-weight: var(--fw-semibold); }

  /* ——— Tarjetas ——— */
  .card {
    background: var(--c-surface);
    border: 1px solid var(--c-border);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-sm);
  }
  .card--metric {
    display: grid;
    align-items: center;
    gap: var(--space-2);
  }
  .card--action {
    display: grid;
    grid-template-columns: auto 1fr;
    align-items: center;
    gap: var(--space-3);
    padding: var(--space-4);
    text-align: left;
    transition: border-color .2s ease, box-shadow .2s ease, transform .02s ease;
  }
  .card--action:hover {
    border-color: color-mix(in srgb, var(--c-secondary) 32%, var(--c-border));
    box-shadow: var(--shadow-md);
  }
  .card--action:active {
    transform: translateY(1px);
  }
  .card--action:focus-visible {
    outline: none;
    box-shadow: 0 0 0 var(--ring-width) var(--ring-color), var(--shadow-md);
  }
  .card__meta {
    margin: 0;
    color: var(--c-text-muted);
    font-size: var(--fs-base);
    font-weight: var(--fw-medium);
  }
  .card__value {
    margin: 0;
    color: var(--c-text);
    font-size: var(--fs-h3);
    font-weight: var(--fw-bold);
    line-height: 1.2;
  }
  .card__icon {
    width: var(--space-9);
    height: var(--space-9);
    display: grid;
    place-items: center;
    color: var(--c-secondary);
  }
  .card__header, .card__body, .card__footer { padding: var(--space-4); }
  .card__header { border-bottom: 1px solid var(--c-border); }
  .card__footer { border-top: 1px solid var(--c-border); }

  @keyframes skeleton-shimmer {
    100% {
      transform: translateX(100%);
    }
  }

  .skeleton {
    position: relative;
    display: inline-block;
    color: transparent;
    border-radius: var(--radius-sm);
    overflow: hidden;
    background: var(--c-neutral-200);
    user-select: none;
  }
  .skeleton::after {
    content: '';
    position: absolute;
    inset: 0;
    transform: translateX(-100%);
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.45), transparent);
    animation: skeleton-shimmer 1.2s infinite;
  }
  .skeleton--pill {
    min-width: 6ch;
    height: 1.25rem;
    border-radius: var(--radius-full);
  }
  .skeleton--text {
    min-width: 10ch;
    height: 1rem;
  }

  /* ——— View states (loading / empty / error) ——— */
  .view-state {
    width: 100%;
    min-height: clamp(180px, 28vh, 320px);
    padding: var(--space-4);
    display: grid;
    align-items: center;
  }
  #main-content > .view-state {
    min-height: max(220px, calc(100vh - 14rem));
  }
  .view-state__inner {
    width: min(100%, 40rem);
    margin: 0 auto;
    padding: var(--space-5);
    border: 1px solid color-mix(in srgb, var(--c-border) 88%, transparent);
    border-radius: var(--radius-lg);
    background: color-mix(in srgb, var(--c-surface-muted) 75%, var(--c-surface));
    box-shadow: var(--shadow-sm);
    display: grid;
    gap: var(--space-3);
    justify-items: start;
  }
  .view-state__inner--center {
    justify-items: center;
    text-align: center;
  }
  .view-state__spinner {
    width: 1.75rem;
    height: 1.75rem;
    border-radius: var(--radius-full);
    border: 3px solid color-mix(in srgb, var(--c-border) 74%, transparent);
    border-top-color: var(--c-secondary);
    animation: view-state-spin .85s linear infinite;
  }
  .view-state__icon {
    font-size: 1.5rem;
    line-height: 1;
  }
  .view-state__title {
    margin: 0;
    color: var(--c-text);
    font-size: var(--fs-h4);
    font-weight: var(--fw-semibold);
  }
  .view-state__text {
    margin: 0;
    color: var(--c-text-muted);
    font-size: var(--fs-base);
  }
  .view-state__actions {
    width: 100%;
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: var(--space-2);
  }
  .view-state--loading .view-state__inner {
    background: color-mix(in srgb, var(--c-surface) 92%, transparent);
  }

  @keyframes view-state-spin {
    to {
      transform: rotate(360deg);
    }
  }

  /* ——— Badges ——— */
  .badge {
    display: inline-block;
    padding: .25rem .5rem;
    border-radius: var(--radius-full);
    font-size: .8125rem;
    line-height: 1;
    border: 1px solid transparent;
  }
  .badge--primary   { background: color-mix(in srgb, var(--c-primary), #fff 80%); color: var(--c-text); border-color: color-mix(in srgb, var(--c-primary), #000 12%); }
  .badge--success   { background: color-mix(in srgb, var(--c-success), #fff 85%); color: var(--c-text); border-color: color-mix(in srgb, var(--c-success), #000 12%); }
  .badge--warning   { background: color-mix(in srgb, var(--c-warning), #fff 85%); color: var(--c-text); border-color: color-mix(in srgb, var(--c-warning), #000 12%); }
  .badge--error     { background: color-mix(in srgb, var(--c-error),   #fff 85%); color: var(--c-text); border-color: color-mix(in srgb, var(--c-error),   #000 12%); }
  .badge--neutral   { background: var(--c-neutral-100); color: var(--c-text); border-color: var(--c-border); }
  /* Accent badge variant for compact status labels (e.g. account role). */
  .badge--accent    { background: color-mix(in srgb, var(--c-secondary), #fff 86%); color: var(--c-text); border-color: color-mix(in srgb, var(--c-secondary), #000 12%); }

  /* Reusable pill/chip primitive for compact identity blocks (e.g. current user). */
  .c-pill {
    --pill-bg: var(--c-neutral-100);
    --pill-color: var(--c-text);
    --pill-border: var(--c-border);

    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-2);
    padding: var(--space-1) var(--space-3);
    min-height: calc(var(--space-4) + var(--space-2));
    border: 1px solid var(--pill-border);
    border-radius: var(--radius-full);
    background: var(--pill-bg);
    color: var(--pill-color);
    font-size: var(--fs-h6);
    font-weight: var(--fw-medium);
    line-height: 1;
    white-space: nowrap;
  }
  .c-pill--sm {
    gap: var(--space-1);
    padding: var(--space-1) var(--space-2);
    min-height: var(--space-6);
  }

  /* Keep keyboard focus visible on interactive badge/pill usage. */
  :is(a, button).badge:focus-visible,
  :is(a, button).c-pill:focus-visible {
    outline: none;
    box-shadow: 0 0 0 var(--ring-width) var(--ring-color);
  }

  /* ——— Navegación / Menús ——— */
  .nav {
    display: flex; gap: var(--space-3); flex-wrap: wrap;
    list-style: none; padding: 0; margin: 0;
  }
  .nav__link {
    display: inline-flex; align-items: center; gap: .5rem;
    padding: .4rem .75rem;
    border-radius: var(--radius-md);
    color: var(--c-text);
    text-decoration: none;
  }
  .nav__link:hover { background: var(--c-neutral-100); }
  .nav__link[aria-current="page"],
  .nav__link.is-active {
    background: color-mix(in srgb, var(--c-secondary), #fff 85%);
    color: #0b172a;
    box-shadow: inset 0 0 0 1px color-mix(in srgb, var(--c-secondary), #000 15%);
  }

  /* ——— Tablas ——— */
  .table-wrapper {
    width: 100%;
    overflow-x: auto;
    border: 1px solid var(--c-border);
    border-radius: var(--radius-md);
    background: var(--c-surface);
    box-shadow: var(--shadow-sm);
  }

  .data-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
  }

  .data-table thead th {
    position: sticky;
    top: 0;
    background: var(--c-surface-muted);
    color: var(--c-text-muted);
    text-align: left;
    font-weight: var(--fw-semibold);
    font-size: var(--fs-h6);
    border-bottom: 1px solid var(--c-border);
    padding: var(--space-3) var(--space-4);
    z-index: 1;
  }

  .data-table tbody td {
    padding: var(--space-3) var(--space-4);
    border-bottom: 1px solid var(--c-border);
    vertical-align: middle;
    background: var(--c-surface);
  }

  .data-table tbody tr:nth-child(odd) {
    background: color-mix(in srgb, var(--c-surface-muted) 65%, transparent);
  }

  .data-table tbody tr:hover {
    background: color-mix(in srgb, var(--c-surface-muted) 85%, transparent);
  }

  /* ——— Toasts ——— */
  .toast-stack {
    position: fixed;
    inset-block-start: var(--space-6);
    inset-inline-end: var(--space-6);
    display: flex;
    flex-direction: column;
    gap: var(--space-3);
    width: min(340px, 92vw);
    z-index: 120;
    pointer-events: none;
  }

  .toast {
    pointer-events: auto;
    display: grid;
    grid-template-columns: 1fr auto;
    gap: var(--space-3);
    align-items: start;
    padding: var(--space-3) var(--space-4);
    border-radius: var(--radius-md);
    border: 1px solid var(--c-border);
    background: var(--c-surface);
    color: var(--c-text);
    box-shadow: var(--shadow-lg);
    opacity: 0;
    transform: translateX(16px);
    transition: opacity .25s ease, transform .25s ease;
  }

  .toast--visible {
    opacity: 1;
    transform: translateX(0);
  }

  .toast__message {
    margin: 0;
    font-size: var(--fs-base);
    line-height: var(--lh-base);
  }

  .toast__close {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-1);
    border: 1px solid color-mix(in srgb, var(--c-border) 70%, transparent);
    border-radius: var(--radius-sm);
    background: transparent;
    color: inherit;
    padding: var(--space-1) var(--space-2);
    font-size: var(--fs-h6);
    cursor: pointer;
    transition: background .2s ease, border-color .2s ease;
  }

  .toast__close:hover {
    background: color-mix(in srgb, var(--c-secondary) 12%, transparent);
    border-color: color-mix(in srgb, var(--c-secondary) 45%, transparent);
  }

  .toast__close:focus-visible {
    outline: none;
    box-shadow: 0 0 0 var(--ring-width) var(--ring-color);
  }

  .toast--success {
    border-color: color-mix(in srgb, var(--c-success) 30%, var(--c-border));
    background: color-mix(in srgb, var(--c-success) 10%, var(--c-surface));
    color: color-mix(in srgb, var(--c-success) 65%, var(--c-text));
  }

  .toast--error {
    border-color: color-mix(in srgb, var(--c-error) 35%, var(--c-border));
    background: color-mix(in srgb, var(--c-error) 12%, var(--c-surface));
    color: color-mix(in srgb, var(--c-error) 70%, var(--c-text));
  }

  .toast--info {
    border-color: color-mix(in srgb, var(--c-secondary) 30%, var(--c-border));
    background: color-mix(in srgb, var(--c-secondary) 10%, var(--c-surface));
    color: color-mix(in srgb, var(--c-secondary) 65%, var(--c-text));
  }

  .toast--warning {
    border-color: color-mix(in srgb, var(--c-warning) 35%, var(--c-border));
    background: color-mix(in srgb, var(--c-warning) 12%, var(--c-surface));
    color: color-mix(in srgb, var(--c-warning) 70%, var(--c-text));
  }

  @media (max-width: 480px) {
    .toast-stack {
      inset-inline: var(--space-3);
      width: auto;
    }
  }

  /* ——— Layout: contenedor principal ——— */
  .page {
    padding-block: var(--space-6);
    background: var(--c-bg);
  }
}
