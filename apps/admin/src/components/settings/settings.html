<link rel="stylesheet" href="/src/styles/settings.css" />

<section
  id="settings-module"
  class="settings page container"
  data-rbac-module="settings"
  aria-labelledby="settings-title"
>
  <header class="settings__header">
    <div class="settings__heading">
      <h1 id="settings-title" class="settings__title">Configuración</h1>
      <p class="settings__subtitle">Gestioná identidad, contacto y disponibilidad del sitio.</p>
    </div>
    <div class="settings__toolbar" role="group" aria-label="Acciones de configuración">
      <button id="settings-reload" class="btn btn--ghost btn--sm" type="button">Actualizar</button>
    </div>
  </header>

  <section class="settings__content is-loading" aria-live="polite" aria-busy="true" data-status="loading">
    <div class="settings__state settings__state--loading" id="settings-loading" role="status">
      <span class="settings__spinner" aria-hidden="true"></span>
      <p>Cargando configuración…</p>
    </div>

    <div class="settings__state settings__state--error" id="settings-error" role="alert" hidden>
      <p id="settings-error-message">No pudimos cargar la configuración.</p>
      <button id="settings-retry" class="btn btn--ghost btn--sm" type="button">Reintentar</button>
    </div>

    <div class="settings__state settings__state--empty" id="settings-empty" role="status" hidden>
      <p>No hay configuración disponible para mostrar.</p>
    </div>

    <article class="settings__card" id="settings-success" hidden>
      <h2 class="settings__card-title">Identidad, contacto y horarios</h2>

      <form id="settings-hours-form" class="settings__form" novalidate>
        <div id="settings-form-error" class="settings__form-error" role="alert" hidden></div>

        <fieldset class="settings__fieldset">
          <legend>Identidad y contacto</legend>

          <label class="settings__field" for="identity-phone">
            <span class="settings__label">Teléfono</span>
            <input id="identity-phone" name="identity.phone" type="tel" class="input" autocomplete="tel" />
          </label>
          <p class="settings__field-error" data-error-for="identity.phone" hidden></p>

          <label class="settings__field" for="identity-email">
            <span class="settings__label">Email</span>
            <input id="identity-email" name="identity.email" type="email" class="input" autocomplete="email" />
          </label>
          <p class="settings__field-error" data-error-for="identity.email" hidden></p>

          <label class="settings__field" for="identity-address">
            <span class="settings__label">Dirección</span>
            <textarea id="identity-address" name="identity.address" class="input" rows="2" maxlength="180"></textarea>
          </label>
          <p class="settings__field-error" data-error-for="identity.address" hidden></p>

          <label class="settings__field" for="whatsapp-number">
            <span class="settings__label">WhatsApp</span>
            <input id="whatsapp-number" name="whatsapp.number" type="tel" class="input" autocomplete="tel" />
          </label>
          <p class="settings__field-error" data-error-for="whatsapp.number" hidden></p>

          <label class="settings__field" for="whatsapp-message">
            <span class="settings__label">Mensaje CTA de WhatsApp</span>
            <textarea id="whatsapp-message" name="whatsapp.message" class="input" rows="3" maxlength="280"></textarea>
          </label>
          <p class="settings__field-error" data-error-for="whatsapp.message" hidden></p>
        </fieldset>

        <fieldset class="settings__fieldset">
          <legend>Redes sociales</legend>

          <div id="social-links-list" class="settings__social-list"></div>
          <p class="settings__field-error" data-error-for="socialLinks" hidden></p>
          <button id="social-links-add" type="button" class="btn btn--ghost btn--sm">Agregar red social</button>
        </fieldset>

        <fieldset class="settings__fieldset">
          <legend>Mapa</legend>

          <label class="settings__field" for="map-embed-src">
            <span class="settings__label">Embed src de Google Maps</span>
            <textarea
              id="map-embed-src"
              name="map.embedSrc"
              class="input"
              rows="3"
              placeholder="https://www.google.com/maps/embed?..."
            ></textarea>
          </label>
          <p class="settings__field-error" data-error-for="map.embedSrc" hidden></p>
          <p class="settings__field-warning">Pegá sólo el src del iframe o el iframe completo para extraerlo automáticamente.</p>
        </fieldset>

        <fieldset class="settings__fieldset" id="settings-opening-hours">
          <legend>Horario de apertura</legend>
          <div id="settings-hours-grid" class="settings__hours-grid"></div>
          <p class="settings__field-error" data-error-for="hours.openingHours" hidden></p>
        </fieldset>

        <fieldset class="settings__fieldset">
          <legend>Forzado de disponibilidad</legend>
          <label class="settings__field" for="hours-override">
            <span class="settings__label">Forzado</span>
            <select id="hours-override" name="hours.override" class="input"></select>
          </label>
          <p class="settings__field-error" data-error-for="hours.override" hidden></p>
        </fieldset>

        <fieldset class="settings__fieldset">
          <legend>Banner de alerta</legend>
          <label class="settings__field settings__field--inline" for="hours-alert-enabled">
            <input id="hours-alert-enabled" name="hours.alert.enabled" type="checkbox" />
            <span class="settings__label">Habilitar banner de alerta</span>
          </label>
          <label class="settings__field" for="hours-alert-message">
            <span class="settings__label">Mensaje</span>
            <textarea
              id="hours-alert-message"
              name="hours.alert.message"
              class="input"
              rows="3"
              maxlength="280"
              placeholder="Ej.: Cerrado por mantenimiento"
            ></textarea>
          </label>
          <p class="settings__field-error" data-error-for="hours.alert.enabled" hidden></p>
          <p class="settings__field-error" data-error-for="hours.alert.message" hidden></p>
          <p id="hours-alert-message-warning" class="settings__field-warning" hidden>Recomendado: agregá un mensaje para la alerta.</p>
        </fieldset>

        <div class="settings__actions">
          <button
            id="settings-save"
            type="submit"
            class="btn btn--primary"
            data-rbac-action="write"
            data-rbac-hide
            hidden
          >
            Guardar
          </button>
          <p id="settings-readonly-hint" class="settings__readonly-hint" hidden>No tenés permiso para editar.</p>
        </div>
      </form>
    </article>
  </section>
</section>
