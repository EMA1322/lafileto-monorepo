<!-- Vista del módulo Products -->
<link rel="stylesheet" href="/src/styles/products.css" />

<section
  class="products page container"
  id="products-module"
  data-rbac-module="products"
  aria-labelledby="products-title"
>
  <header class="products__header">
    <div class="products__heading">
      <h1 id="products-title" class="products__title">Productos</h1>
      <p class="products__subtitle">Gestioná el catálogo, los precios y el stock disponible.</p>
    </div>
    <div class="products__header-actions">
      <button
        id="product-create"
        class="btn btn--primary"
        type="button"
        data-action="create"
        data-rbac-action="write"
        data-rbac-hide
        hidden
      >
        <span class="icon icon--sm" data-icon="plus" aria-hidden="true"></span>
        <span class="icon-label">Crear producto</span>
      </button>
    </div>
  </header>

  <form class="products__filters" id="products-filters" novalidate>
    <div class="products__filters-group" role="group" aria-label="Buscar">
      <label class="products__label" for="filter-q">Buscar</label>
      <input
        id="filter-q"
        class="form-control form-control--dense products__input"
        type="search"
        name="q"
        placeholder="Buscar por nombre"
        inputmode="search"
        autocomplete="off"
      />
    </div>

    <div class="products__filters-group">
      <label class="products__label" for="filter-category">Categoría</label>
      <select id="filter-category" class="form-control form-control--dense products__select" name="category">
        <option value="all">Todas las categorías</option>
      </select>
    </div>

    <div class="products__filters-group">
      <label class="products__label" for="filter-status">Estado</label>
      <select id="filter-status" class="form-control form-control--dense products__select" name="status">
        <option value="all">Todos</option>
        <option value="active">Activo</option>
        <option value="inactive">Inactivo</option>
      </select>
    </div>


    <div class="products__filters-group products__filter products__filter--offer">
      <label class="products__label products__filter-label" for="products-offer-filter">Oferta</label>
      <select
        id="products-offer-filter"
        class="form-control form-control--dense products__select products__filter-select"
        name="offer"
      >
        <option value="all">Todas</option>
        <option value="true">En oferta</option>
        <option value="false">Sin oferta</option>
      </select>
    </div>

    <div class="products__filters-group">
      <label class="products__label" for="filter-order-by">Ordenar por</label>
      <select id="filter-order-by" class="form-control form-control--dense products__select" name="orderBy">
        <option value="updatedAt">Última actualización</option>
        <option value="name">Nombre</option>
        <option value="price">Precio</option>
      </select>
    </div>

    <div class="products__filters-group">
      <label class="products__label" for="filter-order-dir">Dirección</label>
      <select id="filter-order-dir" class="form-control form-control--dense products__select" name="orderDir">
        <option value="desc">Descendente</option>
        <option value="asc">Ascendente</option>
      </select>
    </div>

    <div class="products__filters-group">
      <label class="products__label" for="filter-page-size">Resultados por página</label>
      <select id="filter-page-size" class="form-control form-control--dense products__select" name="pageSize">
        <option value="10">10</option>
        <option value="20">20</option>
        <option value="50">50</option>
      </select>
    </div>

    <div class="products__filters-group products__filters-group--actions">
      <button id="filter-clear" class="btn btn--ghost btn--sm" type="reset">Limpiar filtros</button>
    </div>
  </form>

  <section
    class="products__content is-loading"
    aria-live="polite"
    aria-busy="false"
    data-status="loading"
  >
    <div class="products__state products__state--loading" id="products-loading" role="status">
      <span class="products__spinner" aria-hidden="true"></span>
      <p>Cargando productos…</p>
    </div>

    <div class="products__state products__state--error" id="products-error" role="alert" hidden>
      <p id="products-error-message">No pudimos cargar los productos. Intentá nuevamente.</p>
      <button id="products-retry" class="btn btn--ghost btn--sm" type="button">Reintentar</button>
    </div>

    <div class="products__state products__state--empty" id="products-empty" role="status" hidden>
      <p>No encontramos productos con estos filtros.</p>
      <button id="products-empty-clear" class="btn btn--ghost btn--sm" type="button">Limpiar filtros</button>
    </div>

    <div class="table-wrapper products__table-wrapper" id="products-table-wrapper" hidden>
      <table class="data-table products__table" aria-describedby="products-meta">
        <thead>
          <tr>
            <th scope="col" class="products__cell-image">Imagen</th>
            <th scope="col">Nombre</th>
            <th scope="col" class="products__cell--numeric">Precio</th>
            <th scope="col" class="products__cell--numeric">Stock</th>
            <th scope="col">Estado</th>
            <th scope="col">Categoría</th>
            <th scope="col" class="products__cell--actions adminList__th--actions">Acciones</th>
          </tr>
        </thead>
        <tbody id="products-table-body"></tbody>
      </table>
    </div>
  </section>

  <footer class="products__footer">
    <div class="products__meta" id="products-meta" role="status" aria-live="polite">—</div>
    <nav class="products__pagination" aria-label="Paginación de productos">
      <button id="page-first" class="btn btn--ghost btn--sm" type="button" aria-label="Primera página">«</button>
      <button id="page-prev" class="btn btn--ghost btn--sm" type="button" aria-label="Página anterior">‹</button>
      <ol class="products__page-list" id="products-page-list" aria-live="polite"></ol>
      <button id="page-next" class="btn btn--ghost btn--sm" type="button" aria-label="Página siguiente">›</button>
      <button id="page-last" class="btn btn--ghost btn--sm" type="button" aria-label="Última página">»</button>
    </nav>
  </footer>

  <template id="tpl-product-form">
    <div class="products__modal">
      <header class="products__modal-header">
        <h3 id="products-form-title" class="products__modal-title">Producto</h3>
      </header>
      <div class="products__modal-body">
        <form id="products-form" class="products__form" novalidate>
          <div class="products__form-grid">
            <div class="products__field">
              <label for="field-name">Nombre</label>
              <input id="field-name" name="name" class="form-control form-control--dense" type="text" required maxlength="120" />
            </div>
            <div class="products__field">
              <label for="field-description">Descripción</label>
              <textarea id="field-description" name="description" class="form-control form-control--dense" rows="3"></textarea>
            </div>
            <div class="products__field products__field--image">
              <label for="field-image-url">Imagen (URL)</label>
              <input
                id="field-image-url"
                name="imageUrl"
                class="form-control form-control--dense"
                type="url"
                inputmode="url"
                placeholder="https://…"
                autocomplete="off"
              />
              <div class="products__image-preview" data-image-preview>
                <div class="products__image-preview-placeholder" data-image-preview-empty>
                  Sin vista previa
                </div>
                <img
                  data-image-preview-img
                  alt="Vista previa de la imagen del producto"
                  class="products__image-preview-img"
                  hidden
                />
              </div>
              <p class="products__help-text">Ingresá una URL que comience con http:// o https://</p>
            </div>
            <div class="products__field">
              <label for="field-price">Precio</label>
              <input id="field-price" name="price" class="form-control form-control--dense" type="number" min="0" step="0.01" />
            </div>
            <div class="products__field">
              <label for="field-stock">Stock</label>
              <input id="field-stock" name="stock" class="form-control form-control--dense" type="number" min="0" step="1" />
            </div>
            <div class="products__field">
              <label for="field-category">Categoría</label>
              <select id="field-category" name="categoryId" class="form-control form-control--dense" required></select>
            </div>
          </div>

          <section class="products__section" aria-labelledby="products-offer-title">
            <div class="products__section-header">
              <h4 id="products-offer-title" class="products__section-title">Oferta</h4>
              <label class="products__switch">
                <input id="field-offer-enabled" name="offerEnabled" type="checkbox" />
                <span>Habilitar oferta</span>
              </label>
            </div>
            <div class="products__section-body" data-offer-fields hidden aria-hidden="true">
              <div class="products__field">
                <label for="field-offer-discount">Descuento (%)</label>
                <input
                  id="field-offer-discount"
                  name="offerDiscountPercent"
                  class="form-control form-control--dense"
                  type="number"
                  min="1"
                  max="100"
                  step="0.01"
                  inputmode="decimal"
                />
              </div>
            </div>
          </section>

          <footer class="products__form-actions">
            <button type="button" class="btn btn--ghost" data-close-modal>Cancelar</button>
            <button type="submit" class="btn btn--primary" id="products-form-submit">Guardar</button>
          </footer>
        </form>
      </div>
    </div>
  </template>

  <template id="tpl-product-delete">
    <div class="products__modal products__delete-modal">
      <header class="products__modal-header">
        <h3 class="products__modal-title">Eliminar producto</h3>
      </header>
      <div class="products__modal-body">
        <p id="product-delete-message">Esta acción es definitiva.</p>
      </div>
      <footer class="products__form-actions">
        <button type="button" class="btn btn--ghost" data-close-modal>Cancelar</button>
        <button type="button" id="confirm-delete" class="btn btn--primary">Eliminar</button>
      </footer>
    </div>
  </template>

  <template id="tpl-product-view">
    <div class="products__modal products__view-modal">
      <header class="products__modal-header">
        <h3 class="products__modal-title products__view-title" id="product-view-title">Producto</h3>
      </header>
      <div class="products__modal-body">
        <div class="products__view-body">
          <div class="products__view-media" data-view-image-wrapper>
            <img data-view-image alt="" class="products__image-preview-img" hidden />
            <div class="products__image-preview-placeholder products__image-preview-placeholder--static" data-view-image-empty>Sin imagen</div>
          </div>
          <dl class="products__view-grid">
            <div class="products__view-row">
              <dt class="products__view-label">Precio base</dt>
              <dd class="products__view-value" data-field="price">—</dd>
            </div>
            <div class="products__view-row">
              <dt class="products__view-label">Stock</dt>
              <dd class="products__view-value" data-field="stock">—</dd>
            </div>
            <div class="products__view-row">
              <dt class="products__view-label">Estado</dt>
              <dd class="products__view-value" data-field="status">—</dd>
            </div>
            <div class="products__view-row">
              <dt class="products__view-label">Categoría</dt>
              <dd class="products__view-value" data-field="category">—</dd>
            </div>
          </dl>
        </div>
        <div class="products__view-description">
          <h4>Descripción</h4>
          <p data-field="description">—</p>
        </div>
        <section class="products__view-section" aria-labelledby="product-offer-details-title">
          <div class="products__view-section-header">
            <h4 id="product-offer-details-title" class="products__section-title">Oferta</h4>
            <span class="products__view-tag" data-field="offer-status">Sin oferta activa</span>
          </div>
          <dl class="products__view-grid products__view-grid--compact">
            <div class="products__view-row">
              <dt class="products__view-label">Precio final</dt>
              <dd class="products__view-value" data-field="final-price">—</dd>
            </div>
            <div class="products__view-row">
              <dt class="products__view-label">Descuento</dt>
              <dd class="products__view-value" data-field="discount">—</dd>
            </div>
          </dl>
        </section>
      </div>
      <footer class="products__form-actions">
        <button type="button" class="btn btn--primary" data-close-modal id="product-view-close">Cerrar</button>
      </footer>
    </div>
  </template>
</section>
